<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Pelanggan - GENZET HOME</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    tbody tr:nth-child(even) {
      background-color: #e5e9fd;
    }
    tbody tr:nth-child(odd) {
      background-color: #f3f4ff;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm px-4">
  <img src="Word.png" alt="Logo Word" style="max-width: 8%; height: auto;">
  <div class="collapse navbar-collapse show">
    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
      <li class="nav-item"><a class="nav-link" href="Index.html"><i class="fas fa-chart-line"></i> Laporan</a></li>
      <li class="nav-item"><a class="nav-link" href="absen.html"><i class="fas fa-user-check"></i> Absen</a></li>
      <li class="nav-item"><a class="nav-link" href="pemasukan.html"><i class="fas fa-wallet"></i> Pemasukan</a></li>
      <li class="nav-item"><a class="nav-link" href="pengeluaran.html"><i class="fas fa-money-bill-wave"></i> Pengeluaran</a></li>
      <li class="nav-item"><a class="nav-link" href="asset.html"><i class="fas fa-box"></i> Assets</a></li>
      <li class="nav-item"><a class="nav-link" href="formulir.html"><i class="fas fa-clipboard"></i> Formulir</a></li>
      <li class="nav-item"><a class="nav-link" href="#"><i class="fas fa-check-circle"></i> Approval</a></li>
      <li class="nav-item"><a class="nav-link active" href="pelanggan.html"><i class="fas fa-users"></i> Pelanggan</a></li>
    </ul>
  </div>
</nav>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="text-success"><i class="fas fa-users"></i> Data Pelanggan</h3>
    <button class="btn btn-outline-danger" onclick="exportPDF()"><i class="fas fa-file-pdf"></i> Export PDF</button>
  </div>
  <input type="text" id="searchInput" class="form-control mb-3" placeholder="Cari nama pelanggan...">
  <div class="table-responsive">
    <table class="table table-bordered" id="tabelPelanggan">
      <thead style="background-color: #274eec; color: white;">
        <tr>
          <th>Nama</th>
          <th>Email</th>
          <th>Alamat</th>
          <th>No. Telepon</th>
          <th>Paket</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
  let data = JSON.parse(localStorage.getItem('pelanggan')) || [];

  document.addEventListener('DOMContentLoaded', function () {
    const tbody = document.querySelector('#tabelPelanggan tbody');
    const searchInput = document.getElementById('searchInput');

    function renderTable(filter = '') {
      tbody.innerHTML = '';
      data.forEach((p, index) => {
        if (p.nama.toLowerCase().includes(filter.toLowerCase())) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${p.nama}</td>
            <td>${p.email}</td>
            <td>${p.alamat}, RT ${p.rt}/RW ${p.rw}, Kel. ${p.kelurahan}, Kec. ${p.kecamatan}, ${p.kota}, ${p.provinsi}, ${p.kodepos}</td>
            <td>${p.telepon}</td>
            <td>${p.paket}</td>
            <td><button class="btn btn-sm btn-danger" onclick="hapusPelanggan(${index})"><i class="fas fa-trash-alt"></i></button></td>
          `;
          tbody.appendChild(row);
        }
      });
    }

    renderTable();

    searchInput.addEventListener('input', (e) => {
      renderTable(e.target.value);
    });
  });

  function hapusPelanggan(index) {
    if (confirm('Yakin ingin menghapus pelanggan ini?')) {
      data.splice(index, 1);
      localStorage.setItem('pelanggan', JSON.stringify(data));
      renderTable(document.getElementById('searchInput').value);
    }
  }

  function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Data Pelanggan GENZET HOME", 10, 10);

    let y = 20;
    const dataExport = JSON.parse(localStorage.getItem('pelanggan')) || [];
    dataExport.forEach((p, index) => {
      doc.text(`${index + 1}. ${p.nama}, ${p.email}, ${p.telepon}, ${p.paket}`, 10, y);
      y += 10;
    });

    doc.save("data_pelanggan.pdf");
  }
</script>

</body>
</html>